<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Puzzle House</title>

  <style>
      font-family: system-ui, sans-serif;
      max-width: 700px;
      margin: 40px auto;
      line-height: 1.6;
    }

    button {
      padding: 8px 14px;
      margin-top: 10px;
      cursor: pointer;
    }

    input {
      padding: 8px;
      width: 100%;
      margin-top: 8px;
    }

    .locked {
      opacity: 0.5;
    }

    .room {
      border-top: 1px solid #ddd;
      padding-top: 12px;
      margin-top: 12px;
    }
  </style>
</head>
<body>

  <h1>Puzzle House</h1>

  <div id="app"></div>

  <script>
    /*********************************************************
     * PHASE 1 DATA MODEL
     *********************************************************/

    const PUZZLE_HOUSE = {
      halls: {
        nate: {
          displayName: "Nateâ€™s Puzzle Hall",
          rooms: [
            {
              id: "nate-1",
              title: "The First Door",
              description: "Sometimes the key is exactly what it sounds like.",
              key: "the key", // Phase 1: plaintext (weâ€™ll hash later)
              hints: [
                "Read the instructions literally."
              ]
            },
            {
              id: "nate-2",
              title: "Second Thoughts",
              description: "You may not be ready for this room yet.",
              key: "patience",
              hints: [
                "Waiting is part of the solution."
              ]
            }
          ]
        }
      }
    };

    /*********************************************************
     * PROGRESS PERSISTENCE
     *********************************************************/

    const STORAGE_KEY = "puzzleHouseProgress";

    function loadProgress() {
      return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
        unlockedRooms: {}
      };
    }

    function saveProgress(progress) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
    }

    let progress = loadProgress();

    /*********************************************************
     * CORE LOGIC
     *********************************************************/

    function normalizeInput(str) {
      return str.trim().toLowerCase();
    }

    function attemptUnlock(room, userInput) {
      const normalized = normalizeInput(userInput);
      if (normalized === room.key) {
        progress.unlockedRooms[room.id] = true;
        saveProgress(progress);
        return true;
      }
      return false;
    }

    function isUnlocked(room) {
      return progress.unlockedRooms[room.id];
    }

    /*********************************************************
     * RENDERING
     *********************************************************/

    function render() {
      const app = document.getElementById("app");
      app.innerHTML = "";

      Object.values(PUZZLE_HOUSE.halls).forEach(hall => {
        const hallHeader = document.createElement("h2");
        hallHeader.textContent = hall.displayName;
        app.appendChild(hallHeader);

        hall.rooms.forEach((room, index) => {
          const roomDiv = document.createElement("div");
          roomDiv.className = "room";

          const unlocked =
            index === 0 || isUnlocked(hall.rooms[index - 1]);

          if (!unlocked) {
            roomDiv.classList.add("locked");
            roomDiv.textContent = "ðŸ”’ Locked";
            app.appendChild(roomDiv);
            return;
          }

          const title = document.createElement("h3");
          title.textContent = room.title;

          const desc = document.createElement("p");
          desc.textContent = room.description;

          roomDiv.appendChild(title);
          roomDiv.appendChild(desc);

          if (isUnlocked(room)) {
            const success = document.createElement("p");
            success.textContent = "âœ… Unlocked";
            roomDiv.appendChild(success);
          } else {
            const input = document.createElement("input");
            input.placeholder = "Enter keyâ€¦";

            const button = document.createElement("button");
            button.textContent = "Unlock";
            button.onclick = () => {
              const ok = attemptUnlock(room, input.value);
              alert(ok ? "Unlocked!" : "Incorrect key.");
              render();
            };

            roomDiv.appendChild(input);
            roomDiv.appendChild(button);
          }

          app.appendChild(roomDiv);
        });
      });
    }

    render();
  </script>

</body>
</html>
